<!DOCTYPE html>
<html lang="de-DE">

<head>
	<title>MR DEAD &amp; MRS FREE</title>
	<meta charset="utf-8">
	<meta name="theme-color" content="#000">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href="style.css" rel="stylesheet" type="text/css">
	<script src="lib/lunr.min.js"></script>
</head>

<body>
	<main>
		<input id="searchfield" placeholder="Suche..." type="text" onkeyup="if(this.value.length > 2) {search(this.value)}" onchange="search(this.value)">
		<ul id="resultlist"></ul>
		<div id="overlay">Loading &amp; Indexing Database...</div>
	</main>
	<script>
		var xmlhttp, db, index;
		
		if (window.XMLHttpRequest) {
			xmlhttp = new XMLHttpRequest();
		} else {
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		};

		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				db = JSON.parse(xmlhttp.responseText).deadandfreeSQL;

				index = lunr(function() {
					this.field('ARTIST', {
						boost: 10
					})
					this.field('TITLE', {
						boost: 10
					})
					this.field('KOMMENTAR')
					this.field('D1')
					this.ref('ID')
				});

				for (var i = 0; i < db.length; i++) {
					db[i].ID = i;
					index.add(db[i]);
				};
				
				document.getElementById("overlay").classList.add("done");
			};
		};
		xmlhttp.open("GET", "./db/DBimport.json", true);
		xmlhttp.send();
		
		function createresult(obj) {
			var el = document.createElement("li");
			el.innerHTML = [obj.ARTIST, obj.TITLE, obj.EUR + "â‚¬ <br><br>"].join("<br>");
			return el;
		}

		function search(keyword) {
			var resultlist = document.getElementById("resultlist")
			resultlist.innerHTML = "";
			var results = index.search(keyword);
			for (var i = 0; i < results.length; i++) {
				resultlist.appendChild(createresult(db[results[i].ref]));
			}
		}

	</script>
</body>

</html>
